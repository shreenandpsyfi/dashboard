<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profiling - Parliament Chart</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;

        const ParliamentChart = () => {
          const [data, setData] = useState([
            { cluster: 'The Pragmatic Optimiser', size: 74, color: '#B85860' },
            { cluster: 'The Emotionally Engaged', size: 27, color: '#7A4458' },
            { cluster: 'The Clarity Seeking Professional', size: 33, color: '#E07856' },
            { cluster: 'The Grounded Go-Getter', size: 33, color: '#9370DB' },
            { cluster: 'The Pattern Breaker', size: 18, color: '#D4BADB' }
          ]);

          const [hoveredCluster, setHoveredCluster] = useState(null);

          const totalSeats = data.reduce((sum, d) => sum + d.size, 0);

          const seats = useMemo(() => {
            const rows = 7;
            const seatsPerRow = [13, 17, 21, 25, 29, 33, 37];
            const innerRadius = 145;
            const rowSpacing = 25;
            const centerX = 400;
            const centerY = 420;
            const arcAngle = 182;
            
            const allPositions = [];
            for (let row = 0; row < rows; row++) {
              const radius = innerRadius + row * rowSpacing;
              const seatsInThisRow = seatsPerRow[row];
              
              for (let seat = 0; seat < seatsInThisRow; seat++) {
                const angle = 180 - (seat / (seatsInThisRow - 1)) * arcAngle;
                const radian = (angle * Math.PI) / 180;
                const x = centerX + radius * Math.cos(radian);
                const y = centerY - radius * Math.sin(radian);
                
                allPositions.push({
                  x,
                  y,
                  angle,
                  radius: 10.5
                });
              }
            }
            
            allPositions.sort((a, b) => b.angle - a.angle);
            
            let currentClusterIndex = 0;
            let seatsAssignedInCurrentCluster = 0;
            
            const seatsWithClusters = allPositions.map((pos, idx) => {
              while (seatsAssignedInCurrentCluster >= data[currentClusterIndex].size && currentClusterIndex < data.length - 1) {
                currentClusterIndex++;
                seatsAssignedInCurrentCluster = 0;
              }
              
              const cluster = data[currentClusterIndex];
              seatsAssignedInCurrentCluster++;
              
              return {
                ...pos,
                cluster: cluster.cluster,
                color: cluster.color,
                size: cluster.size
              };
            });
            
            return seatsWithClusters;
          }, [data, totalSeats]);

          const centerInfo = useMemo(() => {
            if (hoveredCluster) {
              const cluster = data.find(d => d.cluster === hoveredCluster);
              return { size: cluster.size, name: cluster.cluster };
            }
            return { size: totalSeats, name: '' };
          }, [hoveredCluster, data, totalSeats]);

          const clusterZones = useMemo(() => {
            const zones = [];
            data.forEach(cluster => {
              const clusterSeats = seats.filter(s => s.cluster === cluster.cluster);
              if (clusterSeats.length === 0) return;
              
              const minX = Math.min(...clusterSeats.map(s => s.x));
              const maxX = Math.max(...clusterSeats.map(s => s.x));
              const minY = Math.min(...clusterSeats.map(s => s.y));
              const maxY = Math.max(...clusterSeats.map(s => s.y));
              
              zones.push({
                cluster: cluster.cluster,
                x: minX - 20,
                y: minY - 20,
                width: maxX - minX + 40,
                height: maxY - minY + 40
              });
            });
            return zones;
          }, [seats, data]);

          return (
            <div className="w-full h-screen bg-[#2d3139] flex flex-col items-center justify-center p-8">
              <h1 className="text-white text-5xl font-bold mb-12 tracking-wider" style={{ letterSpacing: '0.05em' }}>User Profiling</h1>

              <div className="relative">
                <svg width="800" height="580" className="overflow-visible">
                  {clusterZones.map((zone, idx) => (
                    <rect
                      key={`zone-${idx}`}
                      x={zone.x}
                      y={zone.y}
                      width={zone.width}
                      height={zone.height}
                      fill="transparent"
                      className="cursor-pointer"
                      onMouseEnter={() => setHoveredCluster(zone.cluster)}
                      onMouseLeave={() => setHoveredCluster(null)}
                    />
                  ))}
                  
                  {seats.map((seat, idx) => (
                    <circle
                      key={idx}
                      cx={seat.x}
                      cy={seat.y}
                      r={seat.radius}
                      fill={seat.color}
                      opacity={hoveredCluster === null || hoveredCluster === seat.cluster ? 1 : 0.3}
                      className="transition-all duration-200 pointer-events-none"
                      style={{
                        filter: hoveredCluster === seat.cluster ? 'brightness(1.15)' : 'none'
                      }}
                    />
                  ))}

                  <text
                    x="400"
                    y="425"
                    textAnchor="middle"
                    className="fill-white select-none pointer-events-none"
                    style={{ 
                      fontFamily: 'Arial, sans-serif', 
                      fontWeight: 700,
                      fontSize: '96px'
                    }}
                  >
                    {centerInfo.size}
                  </text>
                  
                  {hoveredCluster && (
                    <text
                      x="400"
                      y="455"
                      textAnchor="middle"
                      className="fill-white select-none pointer-events-none"
                      style={{ fontSize: '13px' }}
                    >
                      {centerInfo.name}
                    </text>
                  )}
                </svg>
              </div>

              <div className="mt-8 w-full max-w-3xl">
                <div className="flex justify-between items-center mb-3 pb-2 border-b border-gray-600">
                  <h2 className="text-white text-sm font-semibold tracking-wide">Cluster</h2>
                  <h2 className="text-white text-sm font-semibold tracking-wide">Cluster Size</h2>
                </div>
                {data.map((item, idx) => (
                  <div
                    key={idx}
                    className="flex justify-between items-center py-2.5 px-2 rounded cursor-pointer transition-all duration-150"
                    style={{
                      backgroundColor: hoveredCluster === item.cluster ? 'rgba(255,255,255,0.08)' : 'transparent'
                    }}
                    onMouseEnter={() => setHoveredCluster(item.cluster)}
                    onMouseLeave={() => setHoveredCluster(null)}
                  >
                    <div className="flex items-center gap-3">
                      <div
                        className="w-3 h-3 rounded-full flex-shrink-0"
                        style={{ backgroundColor: item.color }}
                      />
                      <span className="text-white text-sm">{item.cluster}</span>
                    </div>
                    <span className="text-white text-sm font-medium">{item.size}</span>
                  </div>
                ))}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ParliamentChart />);
    </script>
</body>
</html>
